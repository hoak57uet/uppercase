{{ define "main" }}
<style>
    #gallery {
        min-height: 200px;
    }
    .file-item img {
        width: 150px;
        height: 150px;
        object-fit: cover;
        border-radius: 5px;
    }

    .file-status {
        margin-top: 5px;
    }

    .file-item {
        position: relative;
        display: inline-block;
        margin: 10px;
        text-align: center;
    }
    .download-btn {
        position: absolute;
        bottom: 50%; /* Đặt nút ở giữa theo chiều dọc */
        left: 50%; /* Đặt nút ở giữa theo chiều ngang */
        transform: translate(-50%, 50%); /* Đưa nút vào giữa hoàn hảo */
        background-color: #007BFF; /* Nền màu xanh dương */
        color: white;
        padding: 8px 12px; /* Tạo khoảng cách giữa chữ và viền nút */
        font-size: 14px;
        border-radius: 25px; /* Bo tròn nút */
        text-decoration: none; /* Loại bỏ gạch chân */
        font-weight: bold;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Tạo đổ bóng nhẹ */
        opacity: 0; /* Ẩn nút */
        transition: opacity 0.3s ease; /* Hiệu ứng chuyển opacity */
    }

    .file-item:hover .download-btn {
        opacity: 1; /* Hiện nút khi hover */
    }

    .download-btn:hover {
        background-color: #0056b3; /* Đổi màu khi hover */
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<div class="container">
    <h1>Convert WebP to JPG - Bulk Image Converter for Multiple Files</h1>
    <p>Quickly convert multiple WebP images to JPG format online. Upload, convert, and download your images in bulk with
        our fast and efficient WebP to JPG converter tool.</p>
    <div class="upload-box" id="uploadBox">
        <input type="file" id="fileInput" multiple accept="image/webp"/>
        <p>Drag & drop an WEBP image here or <span>browse</span></p>
    </div>
    <div id="gallery"></div>
    <button id="downloadAllBtn" style="display:none;">Download All</button>
    <div>
        <section>
            <h2>About Our WebP to JPG Converter Tool</h2>
            <p>Our WebP to JPG Converter tool allows you to convert multiple WebP images to JPG format easily and
                quickly. JPG is widely used for its compatibility and smaller file size, making it an ideal format for
                web use and image sharing. This tool makes converting from WebP to JPG seamless, even for large batches
                of files.</p>

            <p>You can upload several WebP files at once, convert them to JPG format, and download each image
                individually or all at once as a ZIP file. Whether you're optimizing images for a website or just need
                JPG format for easier sharing, this tool has you covered.</p>

            <h2>How It Works</h2>
            <p>Follow these simple steps to convert your WebP images to JPG:</p>

            <ul>
                <li><strong>Upload WebP Files:</strong> Drag and drop or click the "Upload" button to select multiple
                    WebP images from your device.
                </li>
                <li><strong>Convert to JPG:</strong> After the files are uploaded, click "Convert" to begin converting
                    them to JPG format.
                </li>
                <li><strong>Download JPG Files:</strong> Once the conversion is complete, download each JPG image
                    individually or click "Download All" to get all files in a ZIP file.
                </li>
            </ul>

            <p>This tool is perfect for web developers, designers, and anyone who needs to convert WebP images to JPG
                for better compatibility, smaller file sizes, or faster loading times.</p>
        </section>

        <section>
            <h2>Frequently Asked Questions (FAQ)</h2>

            <h3>1. Why should I convert WebP to JPG?</h3>
            <p>JPG is a widely supported image format with good compression, making it ideal for websites and image
                sharing. It is more compatible across platforms and usually results in smaller file sizes compared to
                WebP.</p>

            <h3>2. Can I upload multiple WebP files at once?</h3>
            <p>Yes, our tool allows you to upload multiple WebP images at once for batch conversion. Simply drag and
                drop your images or use the "Upload" button to select them from your device.</p>

            <h3>3. Is there a limit to how many WebP images I can convert?</h3>
            <p>There are no strict limits, but for best performance, it's recommended to upload files that are within
                reasonable size limits. Our tool is optimized for bulk conversion, so feel free to upload multiple files
                in one go.</p>

            <h3>4. Does converting WebP to JPG affect the image quality?</h3>
            <p>Converting from WebP to JPG may result in some loss of quality since JPG is a compressed format. However,
                the tool is optimized to minimize quality loss while ensuring a smaller file size for faster downloads
                and web use.</p>

            <h3>5. Can I download all converted JPG images at once?</h3>
            <p>Yes, after the conversion, you can either download individual JPG images or use the "Download All" button
                to download all files in a ZIP package.</p>

            <h3>6. Is this tool mobile-friendly?</h3>
            <p>Yes, our WebP to JPG converter works smoothly on both desktop and mobile devices, making it easy to use
                across different platforms.</p>

            <h3>7. Is my data secure?</h3>
            <p>Absolutely. Your images are processed locally in your browser, ensuring that no data is uploaded to any
                server. This means your files stay private and secure.</p>
        </section>


    </div>


</div>

<script>
    const gallery = document.getElementById('gallery');
    const convertedFiles = []; // Mảng lưu trữ blob của các file đã convert
    function handleFiles(files) {
        for (let file of files) {
            if (file.type === 'image/webp') {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function () {
                        convertToJPG(img, file.name);
                    };
                };
                reader.readAsDataURL(file);
            }
        }
    }

    function convertToJPG(pngImage, fileName) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = pngImage.width;
        canvas.height = pngImage.height;
        ctx.drawImage(pngImage, 0, 0);
        canvas.toBlob(function (blob) {
            const jpgFileName = fileName.replace('.webp', '.jpg');
            displayImage(blob, jpgFileName);
            convertedFiles.push({name: jpgFileName, blob});
            updateDownloadAllButton();
        }, 'image/jpeg', 0.92);
    }

    function displayImage(blob, fileName) {
        const fileItem = document.createElement('div');
        fileItem.classList.add('file-item');

        const img = document.createElement('img');
        img.src = URL.createObjectURL(blob);

        // const fileStatus = document.createElement('div');
        // fileStatus.classList.add('file-status');
        // fileStatus.innerText = 'DONE';

        const downloadBtn = document.createElement('a');
        downloadBtn.classList.add('download-btn');
        downloadBtn.href = URL.createObjectURL(blob);
        downloadBtn.download = fileName.replace('.webp', '.jpg');
        downloadBtn.innerText = 'Download';

        fileItem.appendChild(img);
        // fileItem.appendChild(fileStatus);
        fileItem.appendChild(downloadBtn);
        gallery.appendChild(fileItem);
    }

    function updateDownloadAllButton() {
        const downloadAllBtn = document.getElementById('downloadAllBtn');
        if (convertedFiles.length > 0) {
            downloadAllBtn.style.display = 'block'; // Hiện nút Download All nếu có file
            downloadAllBtn.onclick = downloadAll; // Gán sự kiện click cho nút
        } else {
            downloadAllBtn.style.display = 'none'; // Ẩn nút nếu không có file
        }
    }

    async function downloadAll() {
        const zip = new JSZip();
        for (const file of convertedFiles) {
            zip.file(file.name, file.blob);
        }
        const content = await zip.generateAsync({type: 'blob'});
        const url = URL.createObjectURL(content);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'converted_images.zip';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    uploadBox.addEventListener('click', () => {
        fileInput.click();
    });

    uploadBox.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadBox.style.borderColor = '#007bff';
        uploadBox.style.backgroundColor = '#f0f8ff';
    });

    uploadBox.addEventListener('dragleave', () => {
        uploadBox.style.borderColor = '#aaa';
        uploadBox.style.backgroundColor = '#f9f9f9';
    });

    uploadBox.addEventListener('drop', (e) => {
        e.preventDefault();
        handleFiles(e.dataTransfer.files);
        uploadBox.style.borderColor = '#aaa';
        uploadBox.style.backgroundColor = '#f9f9f9';
    });

    fileInput.addEventListener('change', () => {
        handleFiles(fileInput.files);
    });
</script>
{{ end }}